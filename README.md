# 音声花火ゲーム with AI感情分析

音声認識とAI感情分析を組み合わせたインタラクティブな花火エフェクトWebアプリケーションです。

## 機能

### 🎤 音声認識
- ブラウザの音声認識APIを使用した日本語音声入力
- リアルタイムでの音声認識とフィードバック
- 音声認識非対応ブラウザでは自動的にテキスト入力モードに切り替え

### 🤖 AI感情分析
- OpenAI APIを使用した感情分析（1-10スコア）
- ポジティブ/ネガティブ度合いの自動判定
- 信頼度とラベル表示
- 感情に基づく色の自動生成

### 🎆 花火エフェクト
- 入力テキストを粒子化して花火として表示
- 感情スコアに応じた色の自動調整
- 2段階のアニメーション（文字形状保持→拡散）
- スムーズなフェードアウト効果

### 🎵 BGM機能
- 複数のBGMトラックの再生
- 音量調整とミュート機能
- トラック切り替え（前/次）
- フェードイン/アウト効果
- ループ再生対応

### 📱 レスポンシブデザイン
- デスクトップとモバイルの両方に対応
- 画面サイズに応じた自動レイアウト調整
- タッチ操作にも対応

## セットアップ

### 1. OpenAI APIキーの設定

`config.js`ファイルでAPIキーを設定してください：

```javascript
const API_CONFIG = {
    OPENAI_API_KEY: 'your-openai-api-key-here', // ここにAPIキーを設定
    MODEL: 'gpt-4o-mini',
    ENDPOINT: 'https://api.openai.com/v1/chat/completions'
};
```

詳細なセットアップ手順は[setup-guide.md](setup-guide.md)を参照してください。

### 2. BGMファイルの配置

`audio/bgm/`フォルダに以下のMP3ファイルを配置してください：

- `main-theme.mp3` - メインテーマ
- `relaxing.mp3` - リラックス用BGM
- `elegant.mp3` - エレガントなBGM
- `minimal.mp3` - ミニマルなBGM

詳細は[audio/README.md](audio/README.md)を参照してください。

### 3. ファイルの実行

HTTPS環境またはlocalhostでファイルを開いてください：

```bash
# ローカルサーバーを起動（例：Python）
python -m http.server 8000

# または Node.js
npx serve .
```

ブラウザで `http://localhost:8000` にアクセスしてください。

## 使用方法

### 音声入力
1. 「🎤 音声認識開始」ボタンをクリック
2. マイクに向かって日本語で話す
3. 音声が認識されると自動的に感情分析が実行され、花火が打ち上がる

### テキスト入力
1. テキスト入力フィールドに文字を入力
2. 「🎆 打ち上げ」ボタンをクリックまたはEnterキーを押す
3. 感情分析が実行され、結果に基づいた色の花火が表示される

### BGM操作
1. **再生/停止**: ▶️ボタンでBGMの再生/停止
2. **トラック切り替え**: ⏮️⏭️ボタンで前後のトラックに切り替え
3. **音量調整**: スライダーで音量を調整
4. **ミュート**: 🔊ボタンでミュートのON/OFF

## 感情分析の仕様

### スコア範囲
- **1-2**: 最悪（極めてネガティブ）
- **3-4**: ネガ（ネガティブ）
- **5**: ややネガ（ややネガティブ）
- **6**: ややポジ（ややポジティブ）
- **7-8**: ポジ（ポジティブ）
- **9-10**: 最高（極めてポジティブ）

### 色マッピング
- **1-5**: 赤系（#FF3B30 → #FFD60A）
- **6-10**: 黄緑系（#FFD60A → #34C759）

## 技術仕様

### 使用技術
- **フロントエンド**: HTML5, CSS3, JavaScript (ES6+)
- **グラフィックス**: HTML5 Canvas API
- **音声認識**: Web Speech API (webkitSpeechRecognition)
- **AI分析**: OpenAI API (GPT-4o-mini)
- **依存関係**: なし（外部ライブラリ不使用）

### 対応ブラウザ
- **推奨**: Google Chrome, Safari, Microsoft Edge
- **音声認識**: WebkitSpeechRecognition API対応ブラウザ
- **フォールバック**: 音声認識非対応ブラウザでもテキスト入力は利用可能

### 設定パラメータ
```javascript
CONFIG = {
    DOT_GAP: 3,           // ドットのサンプリング間隔
    HOLD_MS: 1000,        // 文字形状を保持する時間
    SPREAD_SPEED: 2,      // 拡散速度
    FADE_SPEED: 0.02,     // フェード速度
    MAX_LIFE: 1.0,        // 粒子の最大寿命
    FONT_SIZE_BASE: 120,  // ベースフォントサイズ
    FONT_SIZE_MIN: 40,    // 最小フォントサイズ
    MAX_TEXT_WIDTH: 0.8   // 画面幅に対する最大テキスト幅
}
```

## エラーハンドリング

### 音声認識エラー
- マイクアクセス拒否時の適切なメッセージ表示
- 音声認識失敗時のフィードバック
- 非対応ブラウザでの自動フォールバック

### API エラー
- OpenAI APIキー未設定時のエラーメッセージ
- API呼び出し失敗時のフォールバック（デフォルト色で表示）
- ネットワークエラー時の適切な処理

## 今後の拡張予定

### 機能拡張
- 複数色の花火パターン
- 音声による花火の種類選択
- アニメーション効果の追加
- 音響効果の追加

### 技術拡張
- WebGLを使用した3Dエフェクト
- Web Audio APIを使用した音響効果
- PWA化によるオフライン対応
- モバイルアプリ化

## ファイル構成
- `index.html`: メインアプリケーション
- `config.js`: API設定ファイル（APIキー設定）
- `sentiment-api.js`: 感情分析APIサービス
- `audio-service.js`: BGM再生サービス
- `audio/`: オーディオファイル用フォルダ
  - `bgm/`: BGMファイル用フォルダ
  - `README.md`: オーディオファイル配置ガイド
- `README.md`: 詳細な使用方法とセットアップ手順
- `setup-guide.md`: セットアップガイド
- `要件.md`: プロジェクト要件定義書
- `アプリケーション概要.md`: アプリケーション概要

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 貢献

バグ報告や機能提案は、GitHubのIssuesページでお知らせください。
