<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Èü≥Â£∞Ëä±ÁÅ´„Ç≤„Éº„É† with AIÊÑüÊÉÖÂàÜÊûê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }
        
        #canvas {
            display: block;
            background: linear-gradient(135deg, #001122, #000033);
        }
        
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .controls button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .controls button:hover {
            background: #45a049;
        }
        
        .controls button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .controls button.recording {
            background: #f44336;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .controls input {
            padding: 10px;
            border: 1px solid #555;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            min-width: 200px;
        }
        
        .controls input::placeholder {
            color: #aaa;
        }
        
        .status {
            font-size: 12px;
            color: #aaa;
            margin-left: 10px;
        }
        
        .sentiment-display {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 10px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 12px;
        }
        
        .sentiment-score {
            font-weight: bold;
            font-size: 14px;
        }
        
        .sentiment-label {
            padding: 2px 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .sentiment-confidence {
            color: #aaa;
        }
        
        .audio-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 12px;
        }
        
        .audio-controls button {
            padding: 6px 10px;
            border: none;
            border-radius: 3px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }
        
        .audio-controls button:hover {
            background: #45a049;
        }
        
        .audio-controls button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .audio-controls button.active {
            background: #f44336;
        }
        
        .audio-controls button.muted {
            background: #ff9800;
        }
        
        .volume-slider {
            width: 60px;
            height: 4px;
            background: #555;
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }
        
        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 12px;
            height: 12px;
            background: #4CAF50;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .track-info {
            font-size: 10px;
            color: #aaa;
            min-width: 80px;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .controls input {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div class="controls">
        <button id="micBtn">üé§ Èü≥Â£∞Ë™çË≠òÈñãÂßã</button>
        <input type="text" id="textInput" placeholder="„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" maxlength="50">
        <button id="launchBtn">üéÜ Êâì„Å°‰∏ä„Åí</button>
        <div class="status" id="status">Ê∫ñÂÇôÂÆå‰∫Ü</div>
        <div class="sentiment-display" id="sentimentDisplay" style="display: none;">
            <span class="sentiment-score" id="sentimentScore">-</span>
            <span class="sentiment-label" id="sentimentLabel">-</span>
            <span class="sentiment-confidence" id="sentimentConfidence">-</span>
        </div>
        <div class="audio-controls" id="audioControls">
            <button id="playPauseBtn" title="ÂÜçÁîü/ÂÅúÊ≠¢">‚ñ∂Ô∏è</button>
            <button id="prevTrackBtn" title="Ââç„ÅÆ„Éà„É©„ÉÉ„ÇØ">‚èÆÔ∏è</button>
            <button id="nextTrackBtn" title="Ê¨°„ÅÆ„Éà„É©„ÉÉ„ÇØ">‚è≠Ô∏è</button>
            <button id="muteBtn" title="„Éü„É•„Éº„Éà">üîä</button>
            <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="30" title="Èü≥Èáè">
            <div class="track-info" id="trackInfo">BGMÂÅúÊ≠¢‰∏≠</div>
        </div>
    </div>

    <!-- Â§ñÈÉ®„Çπ„ÇØ„É™„Éó„Éà„ÅÆË™≠„ÅøËæº„Åø -->
    <script src="config.js"></script>
    <script src="sentiment-api.js"></script>
    <script src="audio-service.js"></script>

    <script>
        // ÂÆöÊï∞ÂÆöÁæ©
        const CONFIG = {
            DOT_GAP: 3,           // „Éâ„ÉÉ„Éà„ÅÆ„Çµ„É≥„Éó„É™„É≥„Ç∞ÈñìÈöî
            HOLD_MS: 1000,        // ÊñáÂ≠óÂΩ¢Áä∂„Çí‰øùÊåÅ„Åô„ÇãÊôÇÈñì
            SPREAD_SPEED: 2,      // Êã°Êï£ÈÄüÂ∫¶
            FADE_SPEED: 0.02,     // „Éï„Çß„Éº„ÉâÈÄüÂ∫¶
            MAX_LIFE: 1.0,        // Á≤íÂ≠ê„ÅÆÊúÄÂ§ßÂØøÂëΩ
            FONT_SIZE_BASE: 120,  // „Éô„Éº„Çπ„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫
            FONT_SIZE_MIN: 40,    // ÊúÄÂ∞è„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫
            MAX_TEXT_WIDTH: 0.8   // ÁîªÈù¢ÂπÖ„Å´ÂØæ„Åô„ÇãÊúÄÂ§ß„ÉÜ„Ç≠„Çπ„ÉàÂπÖ
        };

        // Ë®≠ÂÆö„ÅÆÂàùÊúüÂåñ
        let isApiConfigured = false;
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´Ë®≠ÂÆö„ÇíÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof initializeConfig === 'function') {
                isApiConfigured = initializeConfig();
            }
            
            if (!isApiConfigured) {
                console.warn('APIË®≠ÂÆö„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇconfig.js„Éï„Ç°„Ç§„É´„ÅßAPI„Ç≠„Éº„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        });

        class Particle {
            constructor(x, y, color = null) {
                this.startX = x;
                this.startY = y;
                this.x = x;
                this.y = y;
                this.vx = 0;
                this.vy = 0;
                this.life = CONFIG.MAX_LIFE;
                this.phase = 'hold'; // 'hold' -> 'spread'
                this.color = color || `hsl(${Math.random() * 60 + 30}, 100%, 70%)`;
            }

            update() {
                if (this.phase === 'spread') {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.life -= CONFIG.FADE_SPEED;
                }
            }

            startSpread() {
                this.phase = 'spread';
                this.vx = (Math.random() - 0.5) * CONFIG.SPREAD_SPEED * 4;
                this.vy = (Math.random() - 0.5) * CONFIG.SPREAD_SPEED * 4;
            }

            draw(ctx) {
                if (this.life <= 0) return;
                
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - 1, this.y - 1, 2, 2);
                ctx.globalAlpha = 1;
            }

            isDead() {
                return this.life <= 0;
            }
        }

        class FireworksGame {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.particles = [];
                this.queue = [];
                this.isPlaying = false;
                this.currentShow = null;
                
                this.recognition = null;
                this.isRecording = false;
                this.currentSentiment = null;
                
                this.init();
            }

            init() {
                this.setupCanvas();
                this.setupSpeechRecognition();
                this.setupEventListeners();
                this.setupAudioControls();
                this.startGameLoop();
                
                window.addEventListener('resize', this.debounce(() => {
                    this.setupCanvas();
                }, 250));
            }

            setupCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            setupSpeechRecognition() {
                if ('webkitSpeechRecognition' in window) {
                    this.recognition = new webkitSpeechRecognition();
                    this.recognition.lang = 'ja-JP';
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;

                    this.recognition.onstart = () => {
                        this.isRecording = true;
                        this.updateUI();
                        this.setStatus('Èü≥Â£∞„ÇíË™çË≠ò‰∏≠...');
                    };

                    this.recognition.onresult = (event) => {
                        const text = event.results[0][0].transcript;
                        this.setStatus(`Ë™çË≠ò: "${text}"`);
                        this.processText(text);
                    };

                    this.recognition.onerror = (event) => {
                        this.setStatus(`„Ç®„É©„Éº: ${event.error}`);
                        this.isRecording = false;
                        this.updateUI();
                    };

                    this.recognition.onend = () => {
                        this.isRecording = false;
                        this.updateUI();
                    };
                } else {
                    this.setStatus('Èü≥Â£∞Ë™çË≠ò„ÅØÈùûÂØæÂøú„Åß„Åô„ÄÇ„ÉÜ„Ç≠„Çπ„ÉàÂÖ•Âäõ„Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    document.getElementById('micBtn').disabled = true;
                }
            }

            setupEventListeners() {
                document.getElementById('micBtn').addEventListener('click', () => {
                    if (this.isRecording) {
                        this.recognition.stop();
                    } else {
                        this.recognition.start();
                    }
                });

                document.getElementById('launchBtn').addEventListener('click', () => {
                    const text = document.getElementById('textInput').value.trim();
                    if (text) {
                        this.processText(text);
                        document.getElementById('textInput').value = '';
                    }
                });

                document.getElementById('textInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('launchBtn').click();
                    }
                });
            }

            // „Ç™„Éº„Éá„Ç£„Ç™„Ç≥„É≥„Éà„É≠„Éº„É´„ÅÆË®≠ÂÆö
            setupAudioControls() {
                // ÂÜçÁîü/ÂÅúÊ≠¢„Éú„Çø„É≥
                document.getElementById('playPauseBtn').addEventListener('click', async () => {
                    try {
                        if (audioService.isPlaying) {
                            await audioService.stop();
                        } else {
                            await audioService.play();
                        }
                        this.updateAudioUI();
                    } catch (error) {
                        console.error('BGMÊìç‰Ωú„Ç®„É©„Éº:', error);
                        this.setStatus('BGMÊìç‰Ωú„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                });

                // Ââç„ÅÆ„Éà„É©„ÉÉ„ÇØ„Éú„Çø„É≥
                document.getElementById('prevTrackBtn').addEventListener('click', async () => {
                    try {
                        await audioService.previousTrack();
                        this.updateAudioUI();
                    } catch (error) {
                        console.error('„Éà„É©„ÉÉ„ÇØÂ§âÊõ¥„Ç®„É©„Éº:', error);
                        this.setStatus('„Éà„É©„ÉÉ„ÇØÂ§âÊõ¥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                });

                // Ê¨°„ÅÆ„Éà„É©„ÉÉ„ÇØ„Éú„Çø„É≥
                document.getElementById('nextTrackBtn').addEventListener('click', async () => {
                    try {
                        await audioService.nextTrack();
                        this.updateAudioUI();
                    } catch (error) {
                        console.error('„Éà„É©„ÉÉ„ÇØÂ§âÊõ¥„Ç®„É©„Éº:', error);
                        this.setStatus('„Éà„É©„ÉÉ„ÇØÂ§âÊõ¥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                });

                // „Éü„É•„Éº„Éà„Éú„Çø„É≥
                document.getElementById('muteBtn').addEventListener('click', () => {
                    const isMuted = audioService.toggleMute();
                    this.updateAudioUI();
                });

                // Èü≥Èáè„Çπ„É©„Ç§„ÉÄ„Éº
                document.getElementById('volumeSlider').addEventListener('input', (e) => {
                    const volume = e.target.value / 100;
                    audioService.setVolume(volume);
                    this.updateAudioUI();
                });

                // ÂàùÊúüUIÊõ¥Êñ∞
                this.updateAudioUI();
            }

            // „Ç™„Éº„Éá„Ç£„Ç™UI„ÅÆÊõ¥Êñ∞
            updateAudioUI() {
                const status = audioService.getStatus();
                const playPauseBtn = document.getElementById('playPauseBtn');
                const muteBtn = document.getElementById('muteBtn');
                const volumeSlider = document.getElementById('volumeSlider');
                const trackInfo = document.getElementById('trackInfo');

                // ÂÜçÁîü/ÂÅúÊ≠¢„Éú„Çø„É≥
                if (status.isPlaying) {
                    playPauseBtn.textContent = '‚è∏Ô∏è';
                    playPauseBtn.classList.add('active');
                } else {
                    playPauseBtn.textContent = '‚ñ∂Ô∏è';
                    playPauseBtn.classList.remove('active');
                }

                // „Éü„É•„Éº„Éà„Éú„Çø„É≥
                if (status.isMuted) {
                    muteBtn.textContent = 'üîá';
                    muteBtn.classList.add('muted');
                } else {
                    muteBtn.textContent = 'üîä';
                    muteBtn.classList.remove('muted');
                }

                // Èü≥Èáè„Çπ„É©„Ç§„ÉÄ„Éº
                volumeSlider.value = Math.round(status.volume * 100);

                // „Éà„É©„ÉÉ„ÇØÊÉÖÂ†±
                if (status.isPlaying) {
                    trackInfo.textContent = `${status.currentTrackName} (${status.currentTrackIndex + 1}/${status.totalTracks})`;
                } else {
                    trackInfo.textContent = 'BGMÂÅúÊ≠¢‰∏≠';
                }
            }

            textToParticles(text, sentiment = null) {
                // „Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„ÇíÂãïÁöÑ„Å´Ë™øÊï¥
                let fontSize = CONFIG.FONT_SIZE_BASE;
                const maxWidth = this.canvas.width * CONFIG.MAX_TEXT_WIDTH;
                
                // „Ç™„Éï„Çπ„ÇØ„É™„Éº„É≥„Ç≠„É£„É≥„Éê„Çπ„Åß„ÉÜ„Ç≠„Çπ„ÉàÂπÖ„ÇíÊ∏¨ÂÆö
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                
                do {
                    tempCtx.font = `bold ${fontSize}px sans-serif`;
                    const metrics = tempCtx.measureText(text);
                    if (metrics.width <= maxWidth || fontSize <= CONFIG.FONT_SIZE_MIN) {
                        break;
                    }
                    fontSize -= 10;
                } while (fontSize > CONFIG.FONT_SIZE_MIN);

                // „Ç™„Éï„Çπ„ÇØ„É™„Éº„É≥„Ç≠„É£„É≥„Éê„Çπ„Åß„ÉÜ„Ç≠„Çπ„Éà„ÇíÊèèÁîª
                tempCanvas.width = maxWidth + 100;
                tempCanvas.height = fontSize + 50;
                tempCtx.font = `bold ${fontSize}px sans-serif`;
                tempCtx.fillStyle = 'white';
                tempCtx.textAlign = 'center';
                tempCtx.textBaseline = 'middle';
                tempCtx.fillText(text, tempCanvas.width / 2, tempCanvas.height / 2);

                // „Éî„ÇØ„Çª„É´„Éá„Éº„Çø„ÇíÂèñÂæó
                const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
                const data = imageData.data;
                const particles = [];

                // ÁîªÈù¢‰∏≠Â§Æ„Å´ÈÖçÁΩÆ„Åô„Çã„Åü„ÇÅ„ÅÆ„Ç™„Éï„Çª„ÉÉ„ÉàË®àÁÆó
                const offsetX = (this.canvas.width - tempCanvas.width) / 2;
                const offsetY = (this.canvas.height - tempCanvas.height) / 2;

                // ÊÑüÊÉÖ„Å´Âü∫„Å•„ÅèËâ≤„ÇíÊ±∫ÂÆö
                let baseColor = `hsl(${Math.random() * 60 + 30}, 100%, 70%)`; // „Éá„Éï„Ç©„É´„ÉàËâ≤
                if (sentiment && sentiment.color) {
                    baseColor = sentiment.color.hex;
                    // „Çπ„Ç≥„Ç¢„Å´Âøú„Åò„Å¶Ëâ≤„ÅÆÈÆÆ„ÇÑ„Åã„Åï„ÇíË™øÊï¥
                    const score = sentiment.score;
                    const normalizedScore = (score - 1) / 9; // 0-1„Å´Ê≠£Ë¶èÂåñ
                    const brightness = 0.5 + (normalizedScore * 0.5); // 0.5-1.0„ÅÆÁØÑÂõ≤
                    baseColor = sentimentService.adjustColorBrightness(baseColor, brightness);
                }

                // „Éî„ÇØ„Çª„É´„Çí„Çµ„É≥„Éó„É™„É≥„Ç∞„Åó„Å¶Á≤íÂ≠ê„ÇíÁîüÊàê
                for (let y = 0; y < tempCanvas.height; y += CONFIG.DOT_GAP) {
                    for (let x = 0; x < tempCanvas.width; x += CONFIG.DOT_GAP) {
                        const index = (y * tempCanvas.width + x) * 4;
                        const alpha = data[index + 3];
                        
                        if (alpha > 128) { // ÈÄèÊòéÂ∫¶„Åå50%‰ª•‰∏ä„ÅÆÂ†¥Âêà
                            particles.push(new Particle(
                                x + offsetX,
                                y + offsetY,
                                baseColor
                            ));
                        }
                    }
                }

                return particles;
            }

            async processText(text) {
                this.setStatus('ÊÑüÊÉÖÂàÜÊûê‰∏≠...');
                
                try {
                    // ÊÑüÊÉÖÂàÜÊûê„Çµ„Éº„Éì„Çπ„ÅÆÁä∂ÊÖãÁ¢∫Ë™ç
                    if (typeof sentimentService === 'undefined') {
                        throw new Error('ÊÑüÊÉÖÂàÜÊûê„Çµ„Éº„Éì„Çπ„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    }
                    
                    const serviceStatus = sentimentService.getStatus();
                    if (!serviceStatus.isInitialized || !serviceStatus.hasApiKey) {
                        throw new Error('APIË®≠ÂÆö„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇconfig.js„Éï„Ç°„Ç§„É´„ÅßAPI„Ç≠„Éº„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    }
                    
                    // ÊÑüÊÉÖÂàÜÊûê„ÇíÂÆüË°å
                    const sentiment = await sentimentService.analyzeSentiment(text);
                    this.currentSentiment = sentiment;
                    
                    // UI„Å´ÁµêÊûú„ÇíË°®Á§∫
                    this.updateSentimentDisplay(sentiment);
                    
                    // Ëä±ÁÅ´„ÇíË°®Á§∫
                    this.show(text, sentiment);
                    
                } catch (error) {
                    console.error('ÊÑüÊÉÖÂàÜÊûê„Ç®„É©„Éº:', error);
                    this.setStatus(`ÊÑüÊÉÖÂàÜÊûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${error.message}`);
                    
                    // „Ç®„É©„ÉºÊôÇ„ÅØ„Éá„Éï„Ç©„É´„ÉàËâ≤„ÅßË°®Á§∫
                    this.show(text, null);
                }
            }

            show(text, sentiment = null) {
                this.queue.push({ text, sentiment });
                if (!this.isPlaying) {
                    this.processQueue();
                }
            }

            async processQueue() {
                if (this.queue.length === 0) {
                    this.isPlaying = false;
                    return;
                }

                this.isPlaying = true;
                const { text, sentiment } = this.queue.shift();
                
                // Êñ∞„Åó„ÅÑÁ≤íÂ≠ê„ÇíÁîüÊàê
                this.particles = this.textToParticles(text, sentiment);
                
                // ‰øùÊåÅ„Éï„Çß„Éº„Ç∫
                await this.sleep(CONFIG.HOLD_MS);
                
                // Êã°Êï£„Éï„Çß„Éº„Ç∫ÈñãÂßã
                this.particles.forEach(particle => particle.startSpread());
                
                // Êã°Êï£ÂÆå‰∫Ü„Åæ„ÅßÂæÖÊ©ü
                await this.waitForSpreadComplete();
                
                // Ê¨°„ÅÆ„Ç≠„É•„Éº„ÇíÂá¶ÁêÜ
                this.processQueue();
            }

            waitForSpreadComplete() {
                return new Promise(resolve => {
                    const checkComplete = () => {
                        if (this.particles.every(p => p.isDead())) {
                            resolve();
                        } else {
                            requestAnimationFrame(checkComplete);
                        }
                    };
                    checkComplete();
                });
            }

            startGameLoop() {
                const loop = () => {
                    this.update();
                    this.draw();
                    requestAnimationFrame(loop);
                };
                loop();
            }

            update() {
                this.particles.forEach(particle => particle.update());
                this.particles = this.particles.filter(particle => !particle.isDead());
            }

            draw() {
                // ËÉåÊôØ„Çí„ÇØ„É™„Ç¢
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Á≤íÂ≠ê„ÇíÊèèÁîª
                this.particles.forEach(particle => particle.draw(this.ctx));
            }

            updateUI() {
                const micBtn = document.getElementById('micBtn');
                if (this.isRecording) {
                    micBtn.textContent = 'üõë ÂÅúÊ≠¢';
                    micBtn.classList.add('recording');
                } else {
                    micBtn.textContent = 'üé§ Èü≥Â£∞Ë™çË≠òÈñãÂßã';
                    micBtn.classList.remove('recording');
                }
            }

            setStatus(message) {
                document.getElementById('status').textContent = message;
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }


            // ÊÑüÊÉÖÂàÜÊûêÁµêÊûú„ÅÆUIÊõ¥Êñ∞
            updateSentimentDisplay(sentiment) {
                const display = document.getElementById('sentimentDisplay');
                const score = document.getElementById('sentimentScore');
                const label = document.getElementById('sentimentLabel');
                const confidence = document.getElementById('sentimentConfidence');

                score.textContent = sentiment.score;
                label.textContent = sentiment.labelJa;
                confidence.textContent = `‰ø°È†ºÂ∫¶: ${(sentiment.confidence * 100).toFixed(0)}%`;

                // Ëâ≤„Å´Âøú„Åò„Å¶„Çπ„Ç≥„Ç¢„ÅÆËâ≤„ÇíÂ§âÊõ¥
                score.style.color = sentiment.color.hex;

                display.style.display = 'flex';
            }
        }

        // „Ç≤„Éº„É†ÈñãÂßã
        window.addEventListener('DOMContentLoaded', () => {
            new FireworksGame();
        });
    </script>
</body>
</html>
